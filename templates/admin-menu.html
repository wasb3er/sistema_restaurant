{% load static %}
<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Administrador</title>
  <link rel="stylesheet" href="{% static 'style.css' %}">
</head>
<body>

  <!--Encabezado principal-->
  <header class="admin-header">
    <h1>Panel del Administrador</h1>
    <div class="user-info">
       {{ request.session.empleado_nombre }}
      <form action="{% url 'logout' %}" method="post" style="display:inline;">
        {% csrf_token %}
        {% comment %} <button type="submit" class="btn-logout">Cerrar sesión</button> {% endcomment %}
        <a href="{% url 'logout_por_rol' 'administrador' %}" class="btn-logout">Cerrar sesión</a>
      </form>
    </div>
  </header>

  {% if messages %}
  <div class="messages">
    {% for message in messages %}
      <div class="alert {{ message.tags }}">{{ message }}</div>
    {% endfor %}
  </div>
  {% endif %}
  <!--Contenedor general del panel-->
  <main class="admin-dashboard">
    <!--Menu de platillos-->
    <section class="card">
      <h2>Gestión de Platillos</h2>
      
      <form id="form-crear" enctype="multipart/form-data" style="margin-top:20px;">
  <input type="text" name="nombre" placeholder="Nombre" required>
  <input type="text" name="descripcion" placeholder="Descripción">
  <input type="number" name="precio" placeholder="Precio" step="0.01" required>
  <input type="number" name="cantidad" placeholder="Cantidad" required>

  <div class="input-imagen">
    <label>Seleccionar imagen</label>
    <input type="file" name="imagen" accept="image/*">
  </div>

  <button type="submit" id="btn-agregar">Agregar Platillo</button>
  <button type="button" id="btn-actualizar" class="oculto">Actualizar Platillo</button>
</form>

      <table class="tabla-platillos">
        <thead>
          <tr>
            <th>Nombre</th>
            <th>Descripción</th>
            <th>Precio</th>
            <th>Cantidad</th>
            <th>Acciones</th>
          </tr>
        </thead>
        <tbody id="tabla-platillos"></tbody>
      </table>
    </section>

    <!--Pedidos-->
    <section class="card">
      <h2>Panel de Pedidos</h2>
      {% if pedidos %}
      <table class="tabla-platillos">
        <tr>
          <th>ID</th>
          <th>Cliente</th>
          <th>Personas</th>
          <th>Total</th>
          <th>Estado</th>
          <th>Acciones</th>
        </tr>
        {% for pedido in pedidos %}
        <tr>
          <td>{{ pedido.id }}</td>
          <td>{{ pedido.nombre_cliente }}</td>
          <td>{{ pedido.personas }}</td>
          <td>${{ pedido.total }}</td>
          <td>{{ pedido.estado }}</td>
          <td>
            <a href="{% url 'cambiar_estado_pedido' pedido.pk %}" class="btn-small">
              {% if pedido.estado == 'pendiente' %}
                 Terminar
              {% else %}
                 Pendiente
              {% endif %}
            </a>
          </td>
        </tr>
        {% endfor %}
      </table>
      {% else %}
        <p>No hay pedidos registrados.</p>
      {% endif %}
    </section>

    <!--Empleados-->
    <section class="card">
      <h2>Gestión de Empleados</h2>
      <button id="addEmployeeBtn" class="btn-primary">+ Agregar Mesero</button>
      <table class="tabla-platillos">
        <thead>
          <tr><th>Nombre</th><th>Usuario</th><th>Rol</th><th>Activo</th></tr>
        </thead>
        <tbody>
          {% for e in empleados %}
          <tr>
            <td>{{ e.nombre }}</td>
            <td>{{ e.username }}</td>
            <td>{{ e.rol }}</td>
            <td>{{ e.activo|yesno:"Sí,No" }}</td>
          </tr>
          {% empty %}
          <tr><td colspan="4">No hay empleados registrados</td></tr>
          {% endfor %}
        </tbody>
      </table>
    </section>
  </main>

  <!--Modal para agregar mesero-->
  <div id="employeeModal" class="modal hidden">
    <div class="modal-content">
      <h3>Agregar nuevo mesero</h3>
      <form id="employeeForm" method="post" action="{% url 'crear_empleado' %}">
        {% csrf_token %}
        <input type="text" name="nombre" placeholder="Nombre completo" required>
        <input type="text" name="username" placeholder="Usuario" required>
        <input type="password" name="password" placeholder="Contraseña" required>
        <input type="hidden" name="rol" value="Mesero"> <br>
        <button type="submit" class="btn-primary">Guardar</button>
        <button type="button" class="btn-secondary" id="closeModal">Cancelar</button>
      </form>
    </div>
  </div>

  <script>
    window.USER_IS_STAFF = true;
  </script>
  <script src="{% static 'js/index.js' %}"></script>
  <script>
    //Control modal
    const modal = document.getElementById('employeeModal');
    const addBtn = document.getElementById('addEmployeeBtn');
    const closeBtn = document.getElementById('closeModal');
    addBtn.onclick = () => modal.classList.remove('hidden');
    closeBtn.onclick = () => modal.classList.add('hidden');
    window.onclick = e => { if (e.target === modal) modal.classList.add('hidden'); };
  </script>
</body>
</html>
